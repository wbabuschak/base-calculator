<!DOCTYPE html>
<html>
    <body>
        <div style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">
            <title id = "title">Number Base Calculator</title>
            <h1 id = "gameTitle">Number Base Calculator</h1>
            <p>By William Babuschak</p>
        </div>
        <div>
            <div style="display: flex; gap: 20px;">
                <div style="display: flex; flex-direction: column">
                    <input id="input" value = "11">
                    <input id="inputbase" min="1" max="36" value = "10" type="number">
                </div>
                <div style="display: flex; flex-direction: column">
                    <input id="outputbase" min="1" max="36" value = "16" type="number">
                    <button id="btnconvert">Convert</button>
                </div>
                <div style="display: flex; flex-direction: column">
                    <label id="output"></label>
                    <div>
                        Caps?
                        <input id="capsCheck" type="checkbox">
                    </div>
                    
                </div>
            </div>
        </div>
    </body>
    <script>
        const charOrder = '0123456789abcdefghijklmnopqrstuvwxyz';
        function convert(){
            let outputlabel = document.getElementById("output");
            let input = document.getElementById("input");
            let inputbase = document.getElementById("inputbase");
            let outputbase = document.getElementById("outputbase");
            inputbase.value = Math.max(inputbase.value, 2);
            inputbase.value = Math.min(inputbase.value, 36);
            inputbase.value = Math.max(inputbase.value, 2);
            outputbase.value = Math.min(outputbase.value, 36);
            outputbase.value = Math.max(outputbase.value, 2);
            if (!verifyInput(input.value)){
                outputlabel.innerHTML = "input must have digits or letters";
                return;
            }
            if (!verifyValidBase(input.value,inputbase.value)){
                outputlabel.innerHTML = "input base too low";
                return;
            }
            if (!verifyInputSize(input.value,inputbase.value)){
                outputlabel.innerHTML = "input out of js bounds";
                return;
            }
            outputlabel.innerHTML = "";
            const outputSpan = document.createElement("span");
            outputSpan.textContent = parseInt(input.value, inputbase.value).toString(outputbase.value);
            if (document.getElementById("capsCheck").checked){
                outputSpan.textContent.toUpperCase();
            }
            outputSpan.id = "output-value";
            const textSpan = document.createElement("span");
            textSpan.textContent = " in base ";
            textSpan.id = "text";
            const outputBaseSpan = document.createElement("span");
            outputBaseSpan.textContent = outputbase.value;
            outputBaseSpan.id = "outputBase-value";
            if (document.getElementById("capsCheck").checked){
                outputBaseSpan.textContent.toUpperCase();
            }
            outputlabel.appendChild(outputSpan);
            outputlabel.appendChild(textSpan);
            outputlabel.appendChild(outputBaseSpan);
        }

        function updateCaps(){
            let caps = document.getElementById("capsCheck").checked;
            let outputSpan = document.getElementById("output-value");
            let outputBaseSpan = document.getElementById("outputBase-value");
            if (!outputSpan || !outputBaseSpan){
                return;
            }
            if (caps){
                outputSpan.textContent = outputSpan.textContent.toUpperCase();
                outputBaseSpan.textContent = outputBaseSpan.textContent.toUpperCase();
            } else {
                outputSpan.textContent = outputSpan.textContent.toLowerCase();
                outputBaseSpan.textContent = outputBaseSpan.textContent.toLowerCase();
            }
        }

        function verifyInput(inputStr){
            const regex = new RegExp(`^-?[${charOrder}]+$`, 'i');
            return regex.test(inputStr);
        }

        function verifyInputSize(inputStr, inputbase){
            const num = parseInt(inputStr, inputbase);
            return (num <= Number.MAX_SAFE_INTEGER && num >= Number.MIN_SAFE_INTEGER);
        }

        function verifyValidBase(inputStr,base){
            const digits = charOrder.slice(0,base);
            const regex = new RegExp(`^-?[${digits}]+$`, 'i'); // ensure that all characters in the input string are in matching the base
            return regex.test(inputStr);
        }
        convert();
        document.getElementById("btnconvert").addEventListener("click", () => convert());
        document.getElementById("capsCheck").addEventListener("click", () => updateCaps());
    </script>
</html>